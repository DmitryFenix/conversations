# Тесты методом чёрного ящика

Этот набор тестов проверяет функциональность API методом чёрного ящика (black box testing), то есть без знания внутренней реализации.

## Установка

```bash
pip install -r tests/requirements.txt
```

## Запуск тестов

### Вариант 1: Упрощённый запуск (без pytest)

```bash
# Простой скрипт, который работает без pytest
python tests/test_manual.py
```

### Вариант 2: С pytest (один раз)

```bash
# Из корня проекта
pytest tests/test_api.py -v

# Или через скрипт
python tests/run_tests.py --once
```

### Непрерывный запуск (watch mode)

```bash
# Автоматически перезапускает тесты каждые 5 секунд
python tests/run_tests.py

# Или с кастомным интервалом (в секундах)
TEST_INTERVAL=10 python tests/run_tests.py
```

### С указанием API URL

```bash
API_BASE_URL=http://localhost:8000 pytest tests/test_api.py -v
```

## Что тестируется

### 1. Создание сессий
- ✅ Ревьюер может создать сессию
- ✅ Создание сессии с невалидными данными отклоняется

### 2. Получение сессий
- ✅ Ревьюер может получить список сессий
- ✅ Ревьюер может получить конкретную сессию
- ✅ Кандидат может получить свою сессию по токену
- ✅ Невалидный токен отклоняется

### 3. Комментарии
- ✅ Кандидат может добавить комментарий
- ✅ Кандидат может получить список комментариев
- ✅ Ревьюер видит комментарии кандидата

### 4. Интеграция с Gitea
- ✅ Сессия содержит информацию о Gitea
- ✅ Создание PR в Gitea
- ✅ Получение информации о PR
- ✅ Синхронизация комментариев из Gitea

### 5. Управление сессиями
- ✅ Кандидат может сигнализировать о готовности
- ✅ Ревьюер может завершить сессию
- ✅ Ревьюер может удалить сессию (soft delete)

### 6. Оценка
- ✅ Ревьюер может запустить оценку сессии
- ✅ Проверка статуса задачи оценки

### 7. Артефакты
- ✅ Получение diff сессии
- ✅ Получение отчёта (может быть не готов)

## Структура тестов

- `conftest.py` - фикстуры (HTTP клиент, тестовые данные)
- `test_api.py` - основные тесты, сгруппированные по функциональности
- `run_tests.py` - скрипт для непрерывного запуска
- `requirements.txt` - зависимости для тестов

## Примечания

- Тесты используют реальный API, поэтому убедитесь, что сервер запущен
- Некоторые тесты могут быть пропущены (skip), если требуемые условия не выполнены (например, Gitea не настроена)
- Тесты создают реальные сессии в базе данных
- Тесты выполняются последовательно и могут зависеть друг от друга

