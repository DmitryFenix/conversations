# Быстрый старт: Система Merge Requests

## Шаг 1: Запуск PostgreSQL

```bash
docker compose up -d postgres
```

Проверка:
```bash
docker compose ps postgres
```

## Шаг 2: Сбор Merge Requests

Собрать MR из существующих diff файлов:
```bash
python scripts/collect_mrs.py --artifacts ./artifacts --output mrs_collected.json
```

Или из локального git репозитория:
```bash
python scripts/collect_mrs.py --repo /path/to/repo --limit 20 --output mrs_collected.json
```

## Шаг 3: Импорт в базу данных

```bash
# Сначала проверить (dry-run)
python scripts/import_mrs.py mrs_collected.json --dry-run

# Затем импортировать
python scripts/import_mrs.py mrs_collected.json
```

## Шаг 4: Проверка API

```bash
# Список всех MR
curl http://localhost:8000/api/mr/list

# Список с фильтрацией
curl "http://localhost:8000/api/mr/list?language=python&difficulty_level=intermediate"

# Детали MR
curl http://localhost:8000/api/mr/1

# Diff MR
curl http://localhost:8000/api/mr/1/diff

# Поиск
curl "http://localhost:8000/api/mr/search?q=security"
```

## Шаг 5: Использование MR в сессиях

При создании сессии можно указать `mr_id`:

```bash
curl -X POST http://localhost:8000/api/reviewer/sessions \
  -H "Content-Type: application/json" \
  -d '{
    "candidate_name": "Иван Иванов",
    "mr_package": "demo_package",
    "reviewer_name": "Reviewer",
    "mr_id": 1
  }'
```

Diff из MR автоматически загрузится в сессию.

## Структура файлов

```
api/
  ├── mr_database.py          # Модуль для работы с PostgreSQL
  ├── migrations/
  │   └── 001_create_mr_tables.sql  # SQL миграция
  └── main.py                 # API endpoints для MR

scripts/
  ├── collect_mrs.py          # Сбор MR из источников
  └── import_mrs.py           # Импорт в БД

MR_SYSTEM_PLAN.md             # План реализации
MR_METRICS.md                 # Описание метрик
MR_IMPLEMENTATION_SUMMARY.md  # Резюме реализации
```

## Переменные окружения

```bash
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=mr_database
POSTGRES_USER=mr_user
POSTGRES_PASSWORD=mr_password
```

## Troubleshooting

### PostgreSQL не запускается
```bash
docker compose logs postgres
```

### Ошибка подключения к БД
Проверьте переменные окружения и убедитесь, что PostgreSQL запущен.

### MR не импортируются
Проверьте логи:
```bash
python scripts/import_mrs.py mrs_collected.json --dry-run
```

